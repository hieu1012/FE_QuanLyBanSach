<!-- Search Bar & Filters -->
<div class="flex items-center gap-3 mb-4 p-4 bg-gray-50 rounded-lg">
  <!-- Quick Search Input -->
  <input nz-input [(ngModel)]="quickKeyword" placeholder="Nhập tên, email, username..." class="w-64"
    (keyup.enter)="onQuickSearch()" />

  <!-- Search Button -->
  <button nz-button nzType="primary" (click)="onQuickSearch()" class="flex items-center gap-2">
    <i class="fa-solid fa-magnifying-glass"></i>
    Tìm kiếm
  </button>

  <!-- Advanced Filter Dropdown -->
  <button nz-button nz-dropdown [nzDropdownMenu]="menu" nzPlacement="bottomCenter" [nzClickHide]="false"
    nzTrigger="click" class="flex items-center gap-2">
    <i class="fa-solid fa-filter"></i>
    Bộ lọc nâng cao
  </button>

  <nz-dropdown-menu #menu="nzDropdownMenu">
    <div nzDropdownSticky class="p-4 w-80 bg-white rounded-lg shadow-lg" (mousedown)="$event.stopPropagation()">
      <form [formGroup]="filterForm" (ngSubmit)="onAdvanceSearch()" autocomplete="off"
        (click)="$event.stopPropagation()">
        <!-- Role Filter -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Vai trò</label>
          <nz-select formControlName="role" nzAllowClear nzPlaceHolder="Chọn vai trò" class="w-full"
            nzDropdownClassName="filter-dropdown-select">
            <nz-option *ngFor="let opt of roleOptions" [nzValue]="opt.value" [nzLabel]="opt.label"></nz-option>
          </nz-select>
        </div>
        <!-- Status Filter -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Trạng thái</label>
          <nz-select formControlName="isActive" nzAllowClear nzPlaceHolder="Chọn trạng thái" class="w-full"
            nzDropdownClassName="filter-dropdown-select">
            <nz-option *ngFor="let opt of statusOptions" [nzValue]="opt.value" [nzLabel]="opt.label"></nz-option>
          </nz-select>
        </div>
        <div class="flex justify-end gap-2 pt-2 border-t">
          <button nz-button nzType="default" type="button" (click)="onResetFilter($event)"
            class="flex items-center gap-1">
            <i class="fa-solid fa-rotate-right"></i>
            Làm mới
          </button>
          <button nz-button nzType="primary" [nzLoading]="loading" type="submit" class="flex items-center gap-1">
            <i class="fa-solid fa-check"></i>
            Áp dụng
          </button>
        </div>
      </form>
    </div>
  </nz-dropdown-menu>

  <!-- Add New Button -->
  <button nz-button nzType="primary" (click)="onAddNew()" class="ml-auto flex items-center gap-2">
    <i class="fa-solid fa-plus"></i>
    Thêm mới
  </button>
</div>

<!-- User Table -->
<nz-table #table [nzData]="listOfUser" [nzLoading]="loading" [nzTotal]="total" [nzPageSize]="pageSize"
  [nzPageIndex]="pageIndex" [nzFrontPagination]="false" [nzPageSizeOptions]="[10, 20, 30, 40, 50]"
  [nzShowSizeChanger]="true" (nzQueryParams)="onQueryParamsChange($event)" [nzScroll]="{ y: '425px' }"
  class="product-table">
  <thead>
    <tr>
      <th nzWidth="45px" nzAlign="center">
        <label nz-checkbox [(ngModel)]="allChecked" (ngModelChange)="checkAll($event)"></label>
      </th>
      <th nzWidth="50px" nzAlign="center">STT</th>
      <th nzWidth="100px" nzAlign="center">Thao tác</th>
      <th nzColumnKey="username" [nzSortFn]="true" nzWidth="200px">Tên đăng nhập</th>
      <th nzColumnKey="email" nzWidth="220px">Email</th>
      <th nzColumnKey="fullName" nzWidth="180px">Họ tên</th>
      <th nzColumnKey="phoneNumber" nzWidth="140px">SĐT</th>
      <th nzColumnKey="address" nzWidth="200px">Địa chỉ</th>
      <th nzColumnKey="role" nzWidth="120px">Vai trò</th>
      <th nzAlign="center" [nzSortFn]="true" nzWidth="110px">Trạng thái</th>
      <th nzColumnKey="createdAt" nzWidth="160px">Ngày tạo</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of table.data; let i = index">
      <td nzAlign="center">
        <label nz-checkbox [(ngModel)]="user.checked" (ngModelChange)="updateAllChecked()"></label>
      </td>
      <td nzAlign="center">
        <span class="text-gray-500 font-medium">{{ i + 1 + (pageIndex - 1) * pageSize }}</span>
      </td>
      <td nzAlign="center">
        <button class="border-gray-200 rounded hover:bg-gray-100 hover:border-blue-300"
                nz-button nz-dropdown [nzDropdownMenu]="userMenus" nzPlacement="bottomCenter" nzSize="small">
          <i class="fas fa-ellipsis-v"></i>
        </button>
        <nz-dropdown-menu #userMenus="nzDropdownMenu">
          <ul nz-menu>
            <li nz-menu-item (click)="onAddNew(user)">
              <i class="fa-solid fa-pen-to-square mr-2"></i>
              Chỉnh sửa
            </li>
            <li nz-menu-item (click)="onDeleteUser(user.id)">
              <i class="fa-solid fa-trash mr-2" style="color:#ff4d4f"></i>
              Xoá
            </li>
          </ul>
        </nz-dropdown-menu>
      </td>
      <td>
        <p class="font-medium text-gray-900 truncate" [title]="user.username">{{ user.username }}</p>
      </td>
      <td>
        <p class="truncate" [title]="user.email">{{ user.email }}</p>
      </td>
      <td>
        <span [title]="user.fullName">{{ user.fullName }}</span>
      </td>
      <td>
        <span>{{ user.phoneNumber || '-' }}</span>
      </td>
      <td>
        <span>{{ user.address || '-' }}</span>
      </td>
      <td>
        <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium"
          [ngClass]="{
            'bg-green-50 text-green-700 border border-green-200': user.role==='MASTER',
            'bg-blue-50 text-blue-700 border border-blue-200': user.role==='ADMIN',
            'bg-gray-50 text-gray-800 border border-gray-200': user.role==='USER'
          }">
          {{
          (user.role === 'MASTER' && 'Quản lý hệ thống') ||
          (user.role === 'ADMIN' && 'Quản trị viên') ||
          (user.role === 'USER' && 'Người dùng') || user.role
          }}
        </span>
      </td>
      <td nzAlign="center">
        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium" [ngClass]="{
          'bg-green-100 text-green-800': user.isActive,
          'bg-gray-100 text-gray-800': !user.isActive
        }">
          <span class="w-1.5 h-1.5 rounded-full mr-1.5" [ngClass]="{
            'bg-green-500': user.isActive,
            'bg-gray-500': !user.isActive
          }"></span>
          {{ user.isActive ? 'Hoạt động' : 'Tạm ngưng' }}
        </span>
      </td>
      <td>
        <span>{{ user.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
      </td>
    </tr>
  </tbody>
</nz-table>


<!-- CSS Styles -->
<style>
  /* Product Table Styles */
  .product-table {
    @apply shadow-md rounded-lg overflow-hidden bg-white;
  }

  /* Table Header */
  ::ng-deep .product-table .ant-table-thead>tr>th {
    @apply bg-gradient-to-r from-gray-50 to-gray-100 font-semibold text-gray-700 text-sm;
    padding: 14px 12px !important;
    border-bottom: 2px solid #e5e7eb !important;
  }

  /* Table Body */
  ::ng-deep .product-table .ant-table-tbody>tr>td {
    @apply text-sm;
    padding: 12px !important;
    vertical-align: middle;
  }

  /* Table Row Hover */
  ::ng-deep .product-table .ant-table-tbody>tr {
    @apply transition-colors duration-150;
  }

  ::ng-deep .product-table .ant-table-tbody>tr:hover>td {
    @apply bg-blue-50;
  }

  /* Zebra Striping */
  ::ng-deep .product-table .ant-table-tbody>tr:nth-child(even) {
    @apply bg-gray-50;
  }

  ::ng-deep .product-table .ant-table-tbody>tr:nth-child(even):hover>td {
    @apply bg-blue-50;
  }

  /* Table Border */
  ::ng-deep .product-table .ant-table-container {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    margin-bottom: 0;
  }

  ::ng-deep .product-table .ant-table {
    margin-bottom: 0 !important;
  }

  /* Sort Icon */
  ::ng-deep .product-table .ant-table-column-sorter {
    @apply text-gray-400;
  }

  ::ng-deep .product-table .ant-table-column-sorter-up.active,
  ::ng-deep .product-table .ant-table-column-sorter-down.active {
    @apply text-blue-600;
  }

  /* Empty State */
  ::ng-deep .product-table .ant-table-placeholder {
    @apply text-gray-500;
    padding: 40px 20px !important;
  }

  /* Loading Overlay */
  ::ng-deep .product-table .ant-spin-nested-loading>div>.ant-spin {
    max-height: none !important;
  }

  /* Pagination Alignment */
  ::ng-deep .ant-table-pagination {
    @apply flex items-center justify-between px-4 py-3 bg-white border-t;
    margin: 16px 0 0 0 !important;
  }

  ::ng-deep .ant-table-pagination.ant-pagination {
    @apply my-0;
  }

  ::ng-deep .ant-pagination {
    @apply flex items-center gap-2;
  }

  /* Page Size Selector */
  ::ng-deep .ant-pagination-options {
    @apply flex items-center gap-2;
    margin-left: 8px;
  }

  ::ng-deep .ant-pagination-options-size-changer .ant-select-selector {
    @apply h-9 flex items-center rounded-md border-gray-300;
    min-height: 36px !important;
    padding: 0 11px !important;
  }

  ::ng-deep .ant-pagination-options-size-changer:hover .ant-select-selector {
    @apply border-blue-500;
  }

  /* Pagination Buttons */
  ::ng-deep .ant-pagination-item,
  ::ng-deep .ant-pagination-prev,
  ::ng-deep .ant-pagination-next {
    @apply h-9 min-w-[36px] flex items-center justify-center rounded-md border border-gray-300 transition-all duration-200;
    line-height: 1;
    margin: 0 4px;
  }

  ::ng-deep .ant-pagination-item:hover,
  ::ng-deep .ant-pagination-prev:hover,
  ::ng-deep .ant-pagination-next:hover {
    @apply border-blue-500 text-blue-600;
  }

  ::ng-deep .ant-pagination-item-active {
    @apply border-blue-500 bg-blue-500 text-white font-semibold;
  }

  ::ng-deep .ant-pagination-item-active:hover {
    @apply bg-blue-600 border-blue-600;
  }

  ::ng-deep .ant-pagination-item a {
    @apply flex items-center justify-center h-full transition-colors;
  }

  ::ng-deep .ant-pagination-jump-next,
  ::ng-deep .ant-pagination-jump-prev {
    @apply h-9 min-w-[36px] flex items-center justify-center;
  }

  ::ng-deep .ant-pagination-disabled,
  ::ng-deep .ant-pagination-disabled:hover {
    @apply opacity-40 cursor-not-allowed border-gray-300;
  }

  /* Pagination Total Text */
  ::ng-deep .ant-pagination-total-text {
    @apply text-sm text-gray-600;
    margin-right: auto;
    padding-right: 16px;
  }

  /* Dropdown Menu */
  ::ng-deep .ant-dropdown-menu {
    @apply shadow-lg rounded-lg;
  }

  /* Input Focus */
  ::ng-deep .ant-input:focus,
  ::ng-deep .ant-select-focused .ant-select-selector {
    @apply border-blue-500 ring-2 ring-blue-100;
  }

  /* Fix Select Dropdown trong Dropdown Menu */
  ::ng-deep .filter-dropdown-select {
    z-index: 1060 !important;
  }

  ::ng-deep .ant-select-dropdown {
    z-index: 1060 !important;
  }

  /* Image Placeholder */
  .product-table img {
    @apply transition-opacity duration-200;
  }

  .product-table img:hover {
    @apply opacity-90;
  }

  /* Responsive adjustments */
  @media (max-width: 1024px) {

    ::ng-deep .product-table .ant-table-thead>tr>th,
    ::ng-deep .product-table .ant-table-tbody>tr>td {
      padding: 10px 8px !important;
      font-size: 13px;
    }
  }

  /* Fix spacing between table and pagination */
  ::ng-deep .product-table .ant-spin-container {
    margin-bottom: 0 !important;
  }

  ::ng-deep .product-table .ant-table-content {
    margin-bottom: 0 !important;
  }

  /* Căn chỉnh pagination items */
  ::ng-deep .ant-pagination-prev .ant-pagination-item-link,
  ::ng-deep .ant-pagination-next .ant-pagination-item-link {
    @apply flex items-center justify-center;
  }

  ::ng-deep .ant-pagination-options-quick-jumper {
    @apply flex items-center gap-2;
    margin-left: 8px;
  }

  ::ng-deep .ant-pagination-options-quick-jumper input {
    @apply h-9 rounded-md border-gray-300;
    width: 50px !important;
    text-align: center;
  }
</style>
