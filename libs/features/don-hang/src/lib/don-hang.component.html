<!--<div class="min-h-screen bg-gray-50 py-10 px-4 lg:px-40">-->
<!--  <div class="max-w-4xl mx-auto">-->

<!--    &lt;!&ndash; Tiêu đề &ndash;&gt;-->
<!--    <h1 class="text-4xl font-black text-gray-800 mb-10">Lịch sử đơn hàng</h1>-->

<!--    &lt;!&ndash; Nếu không có đơn hàng &ndash;&gt;-->
<!--    <div *ngIf="!orders || orders.length === 0" class="text-center py-20">-->
<!--      <i class="fa-solid fa-clipboard-list fa-6x text-gray-300 mb-6"></i>-->
<!--      <p class="text-2xl text-gray-600 mb-4">Bạn chưa có đơn hàng nào</p>-->
<!--      <a routerLink="/" class="bg-amber-500 hover:bg-amber-600 text-white font-bold text-xl px-8 py-3 rounded-2xl">Mua sắm ngay</a>-->
<!--    </div>-->

<!--    &lt;!&ndash; Danh sách đơn hàng (accordion style) &ndash;&gt;-->
<!--    <div *ngIf="orders && orders.length > 0" class="space-y-6">-->
<!--      <div *ngFor="let order of orders"-->
<!--           class="bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl">-->

<!--        &lt;!&ndash; Header order (click để expand) &ndash;&gt;-->
<!--        <div (click)="toggleOrderDetail(order.id)"-->
<!--             class="p-6 cursor-pointer flex justify-between items-center bg-gradient-to-r from-gray-50 to-white border-b border-gray-100">-->
<!--          <div class="flex items-center gap-4">-->
<!--            <div class="w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center">-->
<!--              <i class="fa-solid fa-receipt text-amber-600 text-xl"></i>-->
<!--            </div>-->
<!--            <div>-->
<!--              <h3 class="text-xl font-bold text-gray-800">{{ order.orderId }}</h3>-->
<!--              <p class="text-sm text-gray-500">Đặt ngày {{ order.orderDate | date:'dd/MM/yyyy HH:mm' }}</p>-->
<!--            </div>-->
<!--          </div>-->

<!--          <div class="flex items-center gap-6">-->
<!--            &lt;!&ndash; Status badge &ndash;&gt;-->
<!--            <span class="px-4 py-2 rounded-full text-sm font-bold capitalize"-->
<!--                  [ngClass]="{-->
<!--                    'bg-green-100 text-green-700': order.status === 'DELIVERED',-->
<!--                    'bg-yellow-100 text-yellow-700': order.status === 'PROCESSING',-->
<!--                    'bg-orange-100 text-orange-700': order.status === 'PENDING'-->
<!--                  }">-->
<!--              {{ order.status | lowercase }}-->
<!--            </span>-->

<!--            &lt;!&ndash; Tổng giá &ndash;&gt;-->
<!--            <div class="text-right">-->
<!--              <p class="text-lg font-bold text-red-600">{{ order.totalPrice | number:'1.0-0' }}đ</p>-->
<!--              <p class="text-xs text-gray-500">{{ order.totalItem }} sản phẩm</p>-->
<!--            </div>-->

<!--            &lt;!&ndash; Icon expand &ndash;&gt;-->
<!--            <i class="fa-solid fa-chevron-down text-gray-400 transition-transform duration-300"-->
<!--               [class.rotate-180]="expandedOrders[order.id]"></i>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Detail expand (submenu style) &ndash;&gt;-->
<!--        <div *ngIf="expandedOrders[order.id]"-->
<!--             class="animate-slide-down p-6 bg-gray-50 border-t border-gray-100 space-y-6">-->

<!--          &lt;!&ndash; Thông tin user & địa chỉ &ndash;&gt;-->
<!--          <div class="grid md:grid-cols-2 gap-6">-->
<!--            &lt;!&ndash; User info &ndash;&gt;-->
<!--            <div class="bg-white p-4 rounded-xl shadow-sm">-->
<!--              <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">-->
<!--                <i class="fa-solid fa-user text-amber-600"></i> Thông tin người nhận-->
<!--              </h4>-->
<!--              <p class="text-sm text-gray-700 mb-1"><strong>{{ order.detail.user.fullName }}</strong></p>-->
<!--              <p class="text-sm text-gray-600 mb-1">Email: {{ order.userEmail }}</p>-->
<!--              <p class="text-sm text-gray-600 mb-1">SĐT: {{ order.detail.user.phoneNumber }}</p>-->
<!--              <p class="text-sm text-gray-600">Địa chỉ mặc định: {{ order.detail.user.address }}</p>-->
<!--            </div>-->

<!--            &lt;!&ndash; Order address &ndash;&gt;-->
<!--            <div class="bg-white p-4 rounded-xl shadow-sm">-->
<!--              <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">-->
<!--                <i class="fa-solid fa-map-marker-alt text-blue-600"></i> Địa chỉ giao hàng-->
<!--              </h4>-->
<!--              <p class="text-sm text-gray-700 mb-1"><strong>{{ order.detail.orderAddress.firstName }} {{ order.detail.orderAddress.lastName }}</strong></p>-->
<!--              <p class="text-sm text-gray-600 mb-1">SĐT: {{ order.detail.orderAddress.mobileNo }}</p>-->
<!--              <p class="text-sm text-gray-600">{{ order.detail.orderAddress.address }}, {{ order.detail.orderAddress.state }}, {{ order.detail.orderAddress.city }}</p>-->
<!--              <p class="text-sm text-gray-600">Mã bưu điện: {{ order.detail.orderAddress.pincode }}</p>-->
<!--            </div>-->
<!--          </div>-->

<!--          &lt;!&ndash; Phương thức thanh toán &ndash;&gt;-->
<!--          <div class="bg-white p-4 rounded-xl shadow-sm">-->
<!--            <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">-->
<!--              <i class="fa-solid fa-credit-card text-green-600"></i> Thanh toán-->
<!--            </h4>-->
<!--            <p class="text-sm text-gray-700 capitalize">{{ order.paymentType.replace('_', ' ') }}</p>-->
<!--          </div>-->

<!--          &lt;!&ndash; Danh sách items &ndash;&gt;-->
<!--          <div class="bg-white rounded-xl shadow-sm overflow-hidden">-->
<!--            <h4 class="font-bold text-gray-800 p-4 border-b border-gray-100 flex items-center gap-2">-->
<!--              <i class="fa-solid fa-list text-amber-600"></i> Sản phẩm trong đơn ({{ order.totalItem }})-->
<!--            </h4>-->
<!--            <div class="divide-y divide-gray-100">-->
<!--              <div *ngFor="let item of order.detail.items" class="p-4 flex gap-4">-->
<!--                <img [src]="item.product.imageUrls?.[0] || 'https://via.placeholder.com/80?text=Book'"-->
<!--                     [alt]="item.product.title"-->
<!--                     class="w-16 h-20 object-cover rounded-lg flex-shrink-0">-->
<!--                <div class="flex-1">-->
<!--                  <h5 class="font-semibold text-gray-800 mb-1">{{ item.product.title }}</h5>-->
<!--                  <p class="text-sm text-gray-600 mb-2 line-clamp-2">{{ item.product.description }}</p>-->
<!--                  <p class="text-sm text-gray-500">{{ item.product.categoryName }}</p>-->
<!--                </div>-->
<!--                <div class="text-right">-->
<!--                  <p class="text-lg font-bold text-red-600 mb-1">-->
<!--                    {{ (item.price * item.quantity) | number:'1.0-0' }}đ-->
<!--                  </p>-->
<!--                  <p *ngIf="item.product.discount > 0" class="text-xs line-through text-gray-400 mb-1">-->
<!--                    {{ (item.product.price * item.quantity) | number:'1.0-0' }}đ-->
<!--                  </p>-->
<!--                  <p class="text-sm text-gray-600">x{{ item.quantity }}</p>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->

<!--          &lt;!&ndash; Tổng kết dưới cùng &ndash;&gt;-->
<!--          <div class="pt-4 border-t border-gray-200 text-right">-->
<!--            <p class="text-2xl font-black text-red-600">Tổng: {{ order.totalPrice | number:'1.0-0' }}đ</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->

<div class="min-h-screen bg-gray-50 py-10 px-4 lg:px-40">
  <div class="max-w-5xl mx-auto">

    <h1 class="text-4xl font-black text-gray-800 mb-10">Lịch sử đơn hàng</h1>

    <!-- Trống -->
    <div *ngIf="!orders || orders.length === 0" class="text-center py-20 bg-white rounded-2xl shadow">
      <i class="fa-solid fa-receipt fa-6x text-gray-300 mb-6"></i>
      <p class="text-2xl text-gray-600 mb-6">Bạn chưa có đơn hàng nào</p>
      <a routerLink="/" class="bg-amber-500 hover:bg-amber-600 text-white font-bold px-8 py-4 rounded-2xl shadow-lg transform hover:scale-105 transition">
        Mua sắm ngay
      </a>
    </div>

    <!-- Có đơn hàng -->
    <div *ngIf="orders.length > 0" class="space-y-6">
      <div *ngFor="let order of orders"
           class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300">

        <!-- Header đơn hàng -->
        <div (click)="toggleOrderDetail(order.id, order)"
             class="p-6 cursor-pointer flex justify-between items-center hover:bg-gray-50 transition">

          <div class="flex items-center gap-5">
            <div class="w-14 h-14 bg-amber-100 rounded-2xl flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-box text-amber-600 text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-800">{{ order.orderId }}</h3>
              <p class="text-sm text-gray-500">
                {{ order.orderDate | date:'dd/MM/yyyy HH:mm' }}
              </p>
            </div>
          </div>

          <div class="flex items-center gap-8">
            <span class="px-4 py-2 rounded-full text-sm font-bold"
                  [ngClass]="{
                    'bg-green-100 text-green-700': order.status === 'DELIVERED',
                    'bg-yellow-100 text-yellow-700': order.status === 'PROCESSING',
                    'bg-orange-100 text-orange-700': order.status === 'PENDING',
                    'bg-gray-100 text-gray-700': !order.status
                  }">
              {{ order.status?.toLowerCase() || 'unknown' }}
            </span>

            <div class="text-right">
              <p class="text-2xl font-black text-red-600">{{ order.totalPrice | number:'1.0-0' }}đ</p>
              <p class="text-sm text-gray-500">{{ order.totalItem || 1 }} sản phẩm</p>
            </div>

            <i class="fa-solid fa-chevron-down text-xl text-gray-400 transition-transform duration-300"
               [class.rotate-180]="selectedOrder?.id === order.id"></i>
          </div>
        </div>

        <!-- Chi tiết đơn hàng (expand) -->
        <div *ngIf="selectedOrder?.id === order.id" class="border-t border-gray-200">
          <div class="p-6 bg-gray-50 space-y-6">

            <!-- Loading khi lấy chi tiết -->
            <div *ngIf="loadingDetail" class="text-center py-8">
              <i class="fa-solid fa-spinner fa-spin text-4xl text-amber-500"></i>
              <p class="mt-4 text-gray-600">Đang tải chi tiết...</p>
            </div>

            <!-- Nội dung chi tiết -->
            <div *ngIf="!loadingDetail && selectedOrder">
              <!-- Thông tin giao hàng -->
              <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-5 rounded-xl shadow">
                  <h4 class="font-bold text-lg mb-4 text-amber-700">Người nhận</h4>
                  <p class="font-medium">{{ selectedOrder.orderAddress.firstName }} {{ selectedOrder.orderAddress.lastName }}</p>
                  <p class="text-gray-600">{{ selectedOrder.orderAddress.mobileNo }}</p>
                  <p class="text-gray-600 mt-2">{{ selectedOrder.orderAddress.address }}</p>
                  <p class="text-gray-600">{{ selectedOrder.orderAddress.state }}, {{ selectedOrder.orderAddress.city }}, {{ selectedOrder.orderAddress.pincode }}</p>
                </div>

                <div class="bg-white p-5 rounded-xl shadow">
                  <h4 class="font-bold text-lg mb-4 text-blue-700">Thanh toán</h4>
                  <p><strong>Phương thức:</strong> {{ selectedOrder.paymentType === 'COD' ? 'Thanh toán khi nhận hàng' : selectedOrder.paymentType }}</p>
                  <p class="mt-3 text-2xl font-black text-red-600">
                    Tổng tiền: {{ selectedOrder.totalPrice | number:'1.0-0' }}đ
                  </p>
                </div>
              </div>

              <!-- Danh sách sản phẩm -->
              <div class="bg-white rounded-xl shadow overflow-hidden">
                <div class="bg-amber-50 px-6 py-4 border-b">
                  <h4 class="font-bold text-lg">Sản phẩm trong đơn</h4>
                </div>
                <div class="divide-y">
                  <div *ngFor="let item of selectedOrder.items" class="p-5 flex gap-5 items-center hover:bg-gray-50 transition">
                    <img [src]="item.product.imageUrls?.[0]"
                         [alt]="item.product.title"
                         class="w-20 h-28 object-cover rounded-lg shadow">

                    <div class="flex-1">
                      <h5 class="font-bold text-gray-800">{{ item.product.title }}</h5>
                      <p class="text-sm text-gray-600 mt-1">{{ item.product.categoryName }}</p>
                      <p *ngIf="item.product.discount > 0" class="text-xs text-gray-500 line-through">
                        {{ item.product.price | number:'1.0-0' }}đ
                      </p>
                    </div>

                    <div class="text-right">
                      <p class="text-xl font-bold text-red-600">
                        {{ getItemTotal(item) | number:'1.0-0' }}đ
                      </p>
                      <p class="text-sm text-gray-600">Số lượng: {{ item.quantity }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
