<!--<div class="min-h-screen bg-gray-50 py-10 px-4 lg:px-40">-->
<!--  <div class="max-w-5xl mx-auto">-->

<!--    <h1 class="text-4xl font-black text-gray-800 mb-10">Lịch sử đơn hàng</h1>-->

<!--    &lt;!&ndash; Trống &ndash;&gt;-->
<!--    <div *ngIf="!orders || orders.length === 0" class="text-center py-20 bg-white rounded-2xl shadow">-->
<!--      <i class="fa-solid fa-receipt fa-6x text-gray-300 mb-6"></i>-->
<!--      <p class="text-2xl text-gray-600 mb-6">Bạn chưa có đơn hàng nào</p>-->
<!--      <a routerLink="/" class="bg-amber-500 hover:bg-amber-600 text-white font-bold px-8 py-4 rounded-2xl shadow-lg transform hover:scale-105 transition">-->
<!--        Mua sắm ngay-->
<!--      </a>-->
<!--    </div>-->

<!--    &lt;!&ndash; Có đơn hàng &ndash;&gt;-->
<!--    <div *ngIf="orders.length > 0" class="space-y-6">-->
<!--      <div *ngFor="let order of orders"-->
<!--           class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300">-->

<!--        &lt;!&ndash; Header đơn hàng &ndash;&gt;-->
<!--        <div (click)="toggleOrderDetail(order.id, order)"-->
<!--             class="p-6 cursor-pointer flex justify-between items-center hover:bg-gray-50 transition">-->

<!--          <div class="flex items-center gap-5">-->
<!--            <div class="w-14 h-14 bg-amber-100 rounded-2xl flex items-center justify-center flex-shrink-0">-->
<!--              <i class="fa-solid fa-box text-amber-600 text-2xl"></i>-->
<!--            </div>-->
<!--            <div>-->
<!--              <h3 class="text-xl font-bold text-gray-800">{{ order.orderId }}</h3>-->
<!--              <p class="text-sm text-gray-500">-->
<!--                {{ order.orderDate | date:'dd/MM/yyyy HH:mm' }}-->
<!--              </p>-->
<!--            </div>-->
<!--          </div>-->

<!--          <div class="flex items-center gap-8">-->
<!--            <span class="px-4 py-2 rounded-full text-sm font-bold"-->
<!--                  [ngClass]="{-->
<!--                    'bg-green-100 text-green-700': order.status === 'DELIVERED',-->
<!--                    'bg-yellow-100 text-yellow-700': order.status === 'PROCESSING',-->
<!--                    'bg-orange-100 text-orange-700': order.status === 'PENDING',-->
<!--                    'bg-gray-100 text-gray-700': !order.status-->
<!--                  }">-->
<!--                {{ order.status === 'DELIVERED' ? 'Đã giao' :-->
<!--              order.status === 'PROCESSING' ? 'Đang xử lý' :-->
<!--                order.status === 'PENDING' ? 'Chờ xử lý' : 'Không xác định' }}-->
<!--            </span>-->

<!--            <div class="text-right">-->
<!--              <p class="text-2xl font-black text-red-600">{{ order.totalPrice | number:'1.0-0' }}đ</p>-->
<!--              <p class="text-sm text-gray-500">{{ order.totalItem || 1 }} sản phẩm</p>-->
<!--            </div>-->

<!--            <i class="fa-solid fa-chevron-down text-xl text-gray-400 transition-transform duration-300"-->
<!--               [class.rotate-180]="selectedOrder?.id === order.id"></i>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Chi tiết đơn hàng (expand) &ndash;&gt;-->
<!--        <div *ngIf="selectedOrder?.id === order.id" class="border-t border-gray-200">-->
<!--          <div class="p-6 bg-gray-50 space-y-6">-->

<!--            &lt;!&ndash; Loading khi lấy chi tiết &ndash;&gt;-->
<!--            <div *ngIf="loadingDetail" class="text-center py-8">-->
<!--              <i class="fa-solid fa-spinner fa-spin text-4xl text-amber-500"></i>-->
<!--              <p class="mt-4 text-gray-600">Đang tải chi tiết...</p>-->
<!--            </div>-->

<!--            &lt;!&ndash; Nội dung chi tiết &ndash;&gt;-->
<!--            <div *ngIf="!loadingDetail && selectedOrder">-->
<!--              &lt;!&ndash; Thông tin giao hàng &ndash;&gt;-->
<!--              <div class="grid md:grid-cols-2 gap-6">-->
<!--                <div class="bg-white p-5 rounded-xl shadow">-->
<!--                  <h4 class="font-bold text-lg mb-4 text-amber-700">Người nhận</h4>-->
<!--                  <p class="font-medium">{{ selectedOrder.orderAddress.firstName }} {{ selectedOrder.orderAddress.lastName }}</p>-->
<!--                  <p class="text-gray-600">{{ selectedOrder.orderAddress.mobileNo }}</p>-->
<!--                  <p class="text-gray-600 mt-2">{{ selectedOrder.orderAddress.address }}</p>-->
<!--                  <p class="text-gray-600">{{ selectedOrder.orderAddress.state }}, {{ selectedOrder.orderAddress.city }}, {{ selectedOrder.orderAddress.pincode }}</p>-->
<!--                </div>-->

<!--                <div class="bg-white p-5 rounded-xl shadow">-->
<!--                  <h4 class="font-bold text-lg mb-4 text-blue-700">Thanh toán</h4>-->
<!--                  <p><strong>Phương thức:</strong> {{ selectedOrder.paymentType === 'COD' ? 'Thanh toán khi nhận hàng' : selectedOrder.paymentType }}</p>-->
<!--                  <p class="mt-3 text-2xl font-black text-red-600">-->
<!--                    Tổng tiền: {{ selectedOrder.totalPrice | number:'1.0-0' }}đ-->
<!--                  </p>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Danh sách sản phẩm &ndash;&gt;-->
<!--              <div class="bg-white rounded-xl shadow overflow-hidden">-->
<!--                <div class="bg-amber-50 px-6 py-4 border-b">-->
<!--                  <h4 class="font-bold text-lg">Sản phẩm trong đơn</h4>-->
<!--                </div>-->
<!--                <div class="divide-y">-->
<!--                  <div *ngFor="let item of selectedOrder.items" class="p-5 flex gap-5 items-center hover:bg-gray-50 transition">-->
<!--                    <img [src]="item.product.imageUrls?.[0]"-->
<!--                         [alt]="item.product.title"-->
<!--                         class="w-20 h-28 object-cover rounded-lg shadow">-->

<!--                    <div class="flex-1">-->
<!--                      <h5 class="font-bold text-gray-800">{{ item.product.title }}</h5>-->
<!--                      <p class="text-sm text-gray-600 mt-1">{{ item.product.categoryName }}</p>-->
<!--                      <p *ngIf="item.product.discount > 0" class="text-xs text-gray-500 line-through">-->
<!--                        {{ item.product.price | number:'1.0-0' }}đ-->
<!--                      </p>-->
<!--                    </div>-->

<!--                    <div class="text-right">-->
<!--                      <p class="text-xl font-bold text-red-600">-->
<!--                        {{ getItemTotal(item) | number:'1.0-0' }}đ-->
<!--                      </p>-->
<!--                      <p class="text-sm text-gray-600">Số lượng: {{ item.quantity }}</p>-->
<!--                    </div>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->


<div class="min-h-screen bg-gray-50 py-10 px-4 lg:px-40">
  <div class="max-w-5xl mx-auto">

    <h1 class="text-4xl font-black text-gray-800 mb-10">Lịch sử đơn hàng</h1>

    <!-- Trống -->
    <div *ngIf="!orders || orders.length === 0" class="text-center py-20 bg-white rounded-2xl shadow">
      <i class="fa-solid fa-receipt fa-6x text-gray-300 mb-6"></i>
      <p class="text-2xl text-gray-600 mb-6">Bạn chưa có đơn hàng nào</p>
      <a routerLink="/" class="bg-amber-500 hover:bg-amber-600 text-white font-bold px-8 py-4 rounded-2xl shadow-lg transform hover:scale-105 transition">
        Mua sắm ngay
      </a>
    </div>

    <!-- Có đơn hàng -->
    <div *ngIf="orders. length > 0" class="space-y-6">
      <div *ngFor="let order of orders"
           class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300">

        <!-- Header đơn hàng -->
        <div (click)="toggleOrderDetail(order. id, order)"
             class="p-6 cursor-pointer flex justify-between items-center hover:bg-gray-50 transition">

          <div class="flex items-center gap-5">
            <div class="w-14 h-14 bg-amber-100 rounded-2xl flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-box text-amber-600 text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-800">{{ order.orderId }}</h3>
              <p class="text-sm text-gray-500">
                {{ order.orderDate | date:'dd/MM/yyyy HH:mm' }}
              </p>
            </div>
          </div>

          <div class="flex items-center gap-8">
            <span class="px-4 py-2 rounded-full text-sm font-bold"
                  [ngClass]="{
        'bg-green-100 text-green-700':  order.status === 'DELIVERED',
        'bg-yellow-100 text-yellow-700':  order.status === 'PROCESSING',
        'bg-orange-100 text-orange-700':  order.status === 'PENDING',
        'bg-red-100 text-red-700': order.status === 'CANCELLED',
        'bg-gray-100 text-gray-700': ! order.status
      }">
  {{ order.status === 'DELIVERED' ? 'Đã giao' :
              order.status === 'PROCESSING' ? 'Đang xử lý' :
                order.status === 'PENDING' ? 'Chờ xử lý' :
                  order.status === 'CANCELLED' ? 'Đã hủy' : 'Không xác định' }}
            </span>

            <div class="text-right">
              <p class="text-2xl font-black text-red-600">{{ order.totalPrice | number:'1.0-0' }}đ</p>
              <p class="text-sm text-gray-500">{{ order.totalItem || 1 }} sản phẩm</p>
            </div>

            <i class="fa-solid fa-chevron-down text-xl text-gray-400 transition-transform duration-300"
               [class.rotate-180]="selectedOrder?.id === order.id"></i>
          </div>
        </div>

        <!-- Chi tiết đơn hàng (expand) -->
        <div *ngIf="selectedOrder?. id === order.id" class="border-t border-gray-200">
          <div class="p-6 bg-gray-50 space-y-6">

            <!-- Loading khi lấy chi tiết -->
            <div *ngIf="loadingDetail" class="text-center py-8">
              <i class="fa-solid fa-spinner fa-spin text-4xl text-amber-500"></i>
              <p class="mt-4 text-gray-600">Đang tải chi tiết... </p>
            </div>

            <!-- Nội dung chi tiết -->
            <div *ngIf="!loadingDetail && selectedOrder">
              <!-- Thông tin giao hàng -->
              <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-5 rounded-xl shadow">
                  <h4 class="font-bold text-lg mb-4 text-amber-700">Người nhận</h4>
                  <p class="font-medium">{{ selectedOrder.orderAddress.firstName }} {{ selectedOrder. orderAddress.lastName }}</p>
                  <p class="text-gray-600">{{ selectedOrder. orderAddress.mobileNo }}</p>
                  <p class="text-gray-600 mt-2">{{ selectedOrder.orderAddress.address }}</p>
                  <p class="text-gray-600">{{ selectedOrder.orderAddress.state }}, {{ selectedOrder. orderAddress.city }}, {{ selectedOrder.orderAddress.pincode }}</p>
                </div>

                <div class="bg-white p-5 rounded-xl shadow">
                  <h4 class="font-bold text-lg mb-4 text-blue-700">Thanh toán</h4>
                  <p><strong>Phương thức:</strong> {{ selectedOrder.paymentType === 'COD' ? 'Thanh toán khi nhận hàng' : selectedOrder.paymentType }}</p>
                  <p class="mt-3 text-2xl font-black text-red-600">
                    Tổng tiền: {{ selectedOrder. totalPrice | number:'1.0-0' }}đ
                  </p>
                </div>
              </div>

              <!-- Danh sách sản phẩm -->
              <div class="bg-white rounded-xl shadow overflow-hidden">
                <div class="bg-amber-50 px-6 py-4 border-b">
                  <h4 class="font-bold text-lg">Sản phẩm trong đơn</h4>
                </div>
                <div class="divide-y">
                  <div *ngFor="let item of selectedOrder.items" class="p-5 flex gap-5 items-center hover:bg-gray-50 transition">
                    <img [src]="item.product. imageUrls?.[0]"
                         [alt]="item.product.title"
                         class="w-20 h-28 object-cover rounded-lg shadow">

                    <div class="flex-1">
                      <h5 class="font-bold text-gray-800">{{ item.product.title }}</h5>
                      <p class="text-sm text-gray-600 mt-1">{{ item. product.categoryName }}</p>
                      <p *ngIf="item.product.discount > 0" class="text-xs text-gray-500 line-through">
                        {{ item.product.price | number:'1.0-0' }}đ
                      </p>
                    </div>

                    <div class="text-right">
                      <p class="text-xl font-bold text-red-600">
                        {{ getItemTotal(item) | number:'1.0-0' }}đ
                      </p>
                      <p class="text-sm text-gray-600">Số lượng: {{ item.quantity }}</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Nút hành động -->
              <div class="flex justify-end gap-4 mt-6">
                <!-- Nút Hủy đơn hàng - chỉ hiện khi đơn hàng chưa giao -->
                <button
                  *ngIf="selectedOrder.status !== 'DELIVERED' && selectedOrder.status !== 'CANCELLED' && selectedOrder.status !== 'PROCESSING'"
                  (click)="cancelOrder(selectedOrder.id); $event.stopPropagation()"
                  class="px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center gap-2">
                  <i class="fa-solid fa-times-circle"></i>
                  Hủy đơn hàng
                </button>

                <!-- Nút Thanh toán - chỉ hiện khi chưa thanh toán -->
                <button
                  *ngIf="selectedOrder.status === 'PENDING' && selectedOrder.paymentType === 'COD'"
                  (click)="payOrder(selectedOrder.orderAddress); $event.stopPropagation()"
                  class="px-6 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center gap-2">
                  <i class="fa-solid fa-credit-card"></i>
                  Thanh toán ngay
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
